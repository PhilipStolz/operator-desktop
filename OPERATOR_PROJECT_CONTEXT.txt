PROJECT: Operator

Operator is a cross-platform desktop application built with Electron and TypeScript.
It hosts a web-based chat (ChatGPT) inside a BrowserView and safely executes explicitly
defined local commands extracted from chat output.

CORE GOALS
- Deterministic, machine-readable command execution
- Strict separation of concerns (renderer / preload / main)
- Zero ambiguity between UI text and executable instructions
- Security by explicit allowlisting and protocol discipline

ARCHITECTURE
- electron/main.ts
  Owns BrowserWindow + BrowserView
  Implements IPC handlers
  Executes filesystem actions and command execution
- electron/preload.ts
  contextBridge exposing window.operator API
  No logic, only forwarding and validation
- renderer/renderer.js
  UI logic
  Command inbox
  Result display
  Decoding and copying of details_b64 payloads

COMMAND / RESULT PROTOCOL

Markers (must be exact, alone on their own line):
OPERATOR_CMD
END_OPERATOR_CMD
OPERATOR_RESULT
END_OPERATOR_RESULT

Inside OPERATOR_CMD:
- Plain text only
- One key-value pair per line
- Format: key: value
- Required keys: version, id, action
- Multi-line content MUST be base64:
  - content_b64 (text)
  - patch_b64 (unified diff)

Inside OPERATOR_RESULT:
- id must match command id
- ok: true | false
- summary: one-line human-readable summary
- details_b64: optional, base64 UTF-8 payload

ABSOLUTE RULES
1) Never mix markdown with OPERATOR_CMD or OPERATOR_RESULT
2) Never send multi-line text without base64
3) Never guess file contents
4) Always read before patching
5) Patches must be minimal (single hunk, exact context)
6) UI text is NOT a protocol â€“ only the markers are

INTERFACE SPEC
operator.getInterfaceSpec returns the full, authoritative interface specification
as details_b64 (UTF-8 Base64).

This spec is the single source of truth.
If IPC or behavior is unclear, call getInterfaceSpec first.

CURRENT STATUS
- Renderer successfully decodes details_b64 from OPERATOR_RESULT
- Copy decoded details_b64 works reliably
- Layout does not jump on error messages
- Previous bug cause: overly fragile regex and line-based parsing

WORKFLOW
1) fs.search to locate code
2) fs.readSlice for minimal context
3) fs.patch with patch_b64
4) Verify via execution and OPERATOR_RESULT

PROJECT PHILOSOPHY
Precision over convenience.
Explicitness over magic.
Small diffs over big rewrites.
Machines first, humans second.
