PROJEKTKONTEXT – OPERATOR (AKTUELLER STAND)

Ziel des Projekts
Operator ist eine Electron-Desktop-App, die einen Web-LLM-Chat (z
 B. ChatGPT im BrowserView) einbettet und es dem LLM permittiert, kontrollierte lokale Aktionen vorzuschlagen, die der User explizit bestätigt.
Keine Provider-APIs, keine automatisches DOM-Scraping – stattdessen Plain-Text-Extraktion + explizites Command-Protokoll.

Kernprinzip
LLM schläkt Aktionen ausschließlich in expliziten Textblöcken vor:
OPERATOR_CMD
… 
END_OPERATOR_CMD

Operator:
- extrahiert den Webchat als Plain Text
- scannt nach OPERATOR_CMD
- validiert strikt
- zeigt Commands in einer Inbox
- führt sie nur nach User-Bestätigung aus
- antwortet mit:
OPERATOR_RESULT
… 
END_OPERATOR_RESULT

Self-describing Interface (wichtig)
Damit LLMs die Syntax nicht “raten“, muss ein LLC IMMER zerst die kanonische Schnittstellen-Spezifikation abfragen:
OPERATOR_CMD
version: 1
id: iface-001
action: operator.getInterfaceSpec
END_OPERATOR_CMD

Die Spec kommt als base64 UTF-8 unter details_b64 zurück und ist die verbindliche Quelle für:
- Marker
- Pflichtfelder
- verfügbare Actions
- Payload-Regeln (content_b64, patch_b64)
- Limits und Beispiele

Aktueller Stand (funktional)
Implementiert (Auszug):
- harte Navigation-Allowlist
- Plain-Text-Extraktion via executeJavaScript
- Scanner für OPERATOR_CMD (Marker allein auf eigener Zeile, DoS-Limits)
- Workspace-Sandbox:
  - fs.list
  - fs.read
  - fs.readSlice (line-based slices, token-sparend)
  - fs.search (substring grep, token-sparend)
  - fs.write (mit Bestätigung)
  - fs.delete (mit Bestätigung)
  - fs.patch (strikter Unified-Diff-Applier, single-file, mit Bestätigung)
- operator.getInterfaceSpec (kein Workspace, kein path)
- dedupe nach id (keep last)
- Operator Panel UI: Extract + Scan, Inbox, Run/Selection

Wichtiges Detail: Patch-Applier ist strikt
- Kontextzeilen müssen byte-genau passen
- Schon kieinste Abwechung –> Context mismatch
Empfohlener Workflow: fs.search –– fs.readSlice –– very small fs.patch

Lessons Learned
- UI/Markdown kann Commands unbrauchbar machen: Commands müssen als Plain-Text-Block KOPIERBARL sein
- Mehrzeilige Inhalte nie als “content:“ (plain) senden, sondern über content_b64 / patch_b64
- Große Dateien nicht vollständig lesen (fs.read) wenn ehs nicht nötig ist; lieber fs.search + fs.readSlice

Nächste sinnvolle Verbesserungen (optional)
- UI: details_b64 automatisch decodiert zeigen/kopieren
- zerückführung lese-Helfer (z. B. fs.stat / fs.readMeta mit lineCount + hash)
