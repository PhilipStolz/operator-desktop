<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Operator</title>
  <style>
    :root {
      --sidebar-width: 360px;
      --inbox-height: 220px;
    }
    body {
      margin: 0;
      font-family: sans-serif
    }

    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: var(--sidebar-width);
      border-right: 1px solid #ddd;
      padding: 12px;
      box-sizing: border-box;
      background: #fff;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-x: hidden;
      overflow-y: auto
    }

    .contentHint {
      margin-left: var(--sidebar-width);
      padding: 8px 12px;
      color: #666;
      font-size: 12px;
      user-select: none
    }

    button {
      padding: 8px 10px;
      margin: 0;
      cursor: pointer
    }

    select {
      padding: 6px 8px;
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap
    }

    .small {
      font-size: 12px;
      color: #666
    }

    .error {
      color: #b00020
    }

    .accordion {
      border: 1px solid #eee;
      border-radius: 8px;
      background: #fafafa;
      overflow: visible;
    }

    .accordion + .accordion {
      margin-top: 8px;
    }

    .accordion summary {
      list-style: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 8px 10px;
      font-size: 14px;
      font-weight: 600;
      color: #222;
      user-select: none;
    }

    .accordion summary::-webkit-details-marker {
      display: none;
    }

    .accordion summary::after {
      content: "â–¸";
      font-size: 12px;
      color: #666;
      transition: transform 0.15s ease;
    }

    .accordion[open] summary::after {
      transform: rotate(90deg);
    }

    .accordion[open] summary {
      border-bottom: 1px solid #eee;
      background: #f6f6f6;
    }

    .accordionBody {
      padding: 8px;
    }

    .errorList {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .errorCard {
      border: 1px solid #f1c0c0;
      background: #fff4f4;
      padding: 8px;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .errorMessage {
      font-size: 12px;
      color: #8a0b0b;
      word-break: break-word;
    }

    .errorMeta {
      font-size: 11px;
      color: #666;
    }

    .errorActions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .errorActions button {
      padding: 6px 8px;
      font-size: 12px;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 12px;
      white-space: pre-wrap
    }

    textarea {
      width: 100%;
      height: 140px;
      box-sizing: border-box
    }

    .pill {
      display: inline-block;
      padding: 2px 6px;
      border: 1px solid #ddd;
      border-radius: 999px;
      font-size: 12px
    }

    .sectionTitle {
      margin: 0;
      font-size: 14px
    }

    .inboxPane {
      flex: 0 0 auto;
      height: var(--inbox-height);
      overflow: auto;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 8px
    }

    .cmd {
      border: 1px solid #eee;
      padding: 4px 6px;
      margin: 4px 0;
      border-radius: 6px;
    }

    .cmdCompact .cmdLine {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: nowrap;
    }

    .cmdCompact .cmdLeft {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      min-width: 0;
      flex: 1 1 auto;
    }

    .cmdCompact .cmdLeftText {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .cmdCompact .cmdId {
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
    }

    .cmdCompact .cmdAction {
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .cmdCompact .cmdMeta {
      font-size: 11px;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      min-width: 0;
      flex: 1 1 auto;
    }

    .cmdCompact .cmdRight {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }

    .cmdCompact .cmdStatus {
      font-size: 11px;
      line-height: 1;
    }

    .cmdCompact .cmdBtn {
      padding: 2px;
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .cmdCompact .cmdBtn svg {
      width: 14px;
      height: 14px;
      display: block;
    }

    .cmdSelectCol {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      flex: 0 0 auto;
    }

    .cmdStatusIcon {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }

    .cmdStatusIcon.executed {
      background: #2f8f59;
      border: 1px solid #1f6b3b;
    }

    .cmdStatusIcon.pending {
      background: #d78b10;
      border: 1px solid #a26100;
    }

    .cmd.executed {
      background: #f4fbf7;
    }

    .cmd.pending {
      background: #fff7e0;
    }

    .cmd.active {
      border-color: #0b57d0;
      background: #eef4ff;
      outline: 2px solid rgba(11, 87, 208, 0.35);
    }

    #base64Box.collapsed #base64Body {
      display: none;
    }

    input[type=checkbox] {
      transform: translateY(1px);
    }

    label.chk {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      font-size: 12px;
      color: #333;
      user-select: none;
    }

    /* Modal (command details) */
    .modalOverlay {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      width: var(--sidebar-width);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      box-sizing: border-box;
      background: rgba(0, 0, 0, 0.35);
      z-index: 1000;
    }

    .modalOverlay.open {
      display: flex;
    }

    .modal {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      width: 100%;
      max-width: 900px;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .modalHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
    }

    .modalBody {
      padding: 12px;
      overflow: auto;
    }

    .modalBody pre {
      margin: 0;
    }

    .modalSectionTitle {
      margin: 0 0 6px;
      font-size: 12px;
      color: #666;
    }

    .modalSection {
      margin-bottom: 12px;
    }

    .modalMeta {
      font-size: 12px;
      color: #666;
      margin-bottom: 10px;
    }

    .modalFooter {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      padding: 10px 12px;
      border-top: 1px solid #eee;
      flex-wrap: wrap;
    }

    .resizeHandle {
      background: transparent;
      z-index: 10;
    }

    .resizeHandle.vertical {
      position: fixed;
      top: 0;
      bottom: 0;
      left: calc(var(--sidebar-width) - 3px);
      width: 6px;
      cursor: ew-resize;
      background: #eee;
    }

    .resizeHandle.horizontal {
      position: relative;
      height: 6px;
      cursor: ns-resize;
      width: 100%;
      background: #eee;
    }

    .resetBtn {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid #bbb;
      background: #f6f6f6;
      position: relative;
      padding: 0;
      cursor: pointer;
    }

    .resetBtn::before {
      content: "";
      position: absolute;
      inset: 5px;
      border-radius: 999px;
      background: #d33;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2);
    }

    .resetBtn:active::before {
      inset: 6px;
      background: #b21f1f;
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <details class="accordion" id="actionsSection" open>
      <summary>Actions</summary>
      <div class="accordionBody">
        <div class="row">
          <button id="btnScanClipboard">Scan Clipboard</button>
          <button id="btnExtract">Extract &amp; Scan</button>
          <button id="btnClear">Clear</button>
          <button id="btnCopyBootstrap">Copy LLM Bootstrap Prompt</button>
        </div>
      </div>
    </details>

    <details class="accordion" id="errorsSection">
      <summary id="errorsSummary">Errors (0)</summary>
      <div class="accordionBody">
        <div id="errorList" class="errorList"></div>
      </div>
    </details>

    <details class="accordion" id="inboxSection" open>
      <summary>Command Inbox</summary>
      <div class="accordionBody">
        <div class="row" style="margin-top:8px;">
          <label class="chk">
            <input id="chkStopOnFail" type="checkbox" checked /> stop on fail
          </label>
          <label class="chk">
            <input id="chkAutoCopy" type="checkbox" checked /> auto copy result
          </label>
        </div>
        <div id="inbox" class="inboxPane" style="margin-top:8px;"></div>
        <div class="row" style="margin-top:6px; align-items:center;">
          <button id="btnResetExecuted" class="resetBtn" title="Reset executed states" aria-label="Reset executed states"></button>
          <span class="small">Reset executed states</span>
        </div>
        <div id="inboxResizeHandle" class="resizeHandle horizontal"></div>
      </div>
    </details>

    <details class="accordion" id="resultsSection">
      <summary>Results</summary>
      <div class="accordionBody">
        <div class="sectionTitle">Last Result</div>
        <textarea id="result" readonly></textarea>
        <div class="row">
          <button id="btnCopyResult">Copy Result</button>
          <button id="btnCopyDecoded">Copy decoded details_b64</button>
        </div>
      </div>
    </details>

    <details class="accordion" id="toolsSection">
      <summary>Tools</summary>
      <div class="accordionBody">
        <div class="accordion" id="base64Box" style="margin-top:10px;">
          <summary id="btnToggleBase64">Base64 Helper</summary>
          <div class="accordionBody" id="base64Body">
            <div class="small" style="margin-top:6px;">Text or JSON to base64 (UTF-8).</div>
            <textarea id="base64Input" style="height:80px;" placeholder="Input text or JSON"></textarea>
            <div class="row" style="margin-top:6px;">
              <button id="btnBase64Encode">Encode</button>
              <button id="btnBase64EncodeJson">Encode JSON</button>
              <button id="btnBase64Copy">Copy output</button>
            </div>
            <textarea id="base64Output" style="height:80px;" readonly placeholder="Base64 output"></textarea>
          </div>
        </div>

      </div>
    </details>

    <details class="accordion" id="settingsSection">
      <summary>Settings</summary>
      <div class="accordionBody">
        <div class="row" style="margin-top:8px;">
          <label class="chk">
            <input id="chkAutoScan" type="checkbox" /> auto extract &amp; scan
          </label>
          <label class="small" for="autoScanInterval">interval</label>
          <select id="autoScanInterval">
            <option value="2000">2s</option>
            <option value="3000" selected>3s</option>
            <option value="5000">5s</option>
            <option value="10000">10s</option>
          </select>
        </div>
        <div id="autoScanHint" class="small" style="margin-top:6px; display:none;"></div>
        <div class="small">Auto pauses while you interact with Command Inbox.</div>
      </div>
    </details>
  </div>

  <div class="contentHint">Webchat rechts im Fenster (BrowserView). Sidebar bleibt Operator.</div>

  <div id="sidebarResizeHandle" class="resizeHandle vertical" aria-hidden="true"></div>

  <div id="cmdModalOverlay" class="modalOverlay" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <div id="cmdModalTitle" class="sectionTitle">Command</div>
        <button id="cmdModalClose">Close</button>
      </div>
      <div class="modalBody">
        <div id="cmdModalStatus" class="modalMeta"></div>
        <div class="modalSection">
          <div class="modalSectionTitle">Command</div>
          <pre id="cmdModalJson" class="mono"></pre>
        </div>
        <div class="modalSection" id="cmdModalDecodedSection">
          <div class="modalSectionTitle">Decoded base64</div>
          <pre id="cmdModalDecoded" class="mono"></pre>
        </div>
      </div>
      <div class="modalFooter">
        <button id="cmdModalExecute">Execute</button>
        <button id="cmdModalDismiss">Dismiss</button>
        <button id="cmdModalToggleDecoded">Show decoded</button>
      </div>
    </div>
  </div>
  <script src="./renderer.js"></script>
</body>

</html>
